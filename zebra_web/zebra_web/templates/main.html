<!DOCTYPE html>
<html lang="en">

<head>
    <title>ZEBRA - AppleWatch</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    
</head>


<body>
    <div class="container">

        <div class="header">
            <nav>
                <ul class="nav nav-pills pull-right">
                    <li role="presentation"><a href="/">Home</a>
                    </li>
                    <li role="presentation"><a id="logout" href="logout">Logout</a>
                    </li>
                </ul>
            </nav>
            <h3 class="text-muted">ZEBRA App - An Apple SmartWatch Implementation</h3>
        </div>

        <div class="jumbotron" >
            <h1 id ="demo">Welcome to our DemoA :)</h1>
           
        </div>
         <h4 id ="message" stye=“margin-top: 200px;”> Please Continue to type for 20 seconds Straight</h4>
        <textarea id ="textarea" rows ="4" cols ="150"> 
        </textarea>
        <button id = "b">
        </button>









<script>
    let timeout = null;
    window.addEventListener('keyup', function (e) {
        clearTimeout(timeout);
        timeout = setTimeout(function () {
            document.getElementById("logout").click();
        }, 600000);
    });
    window.addEventListener('mousemove', function (e) {
        clearTimeout(timeout);
        timeout = setTimeout(function () {
            document.getElementById("logout").click();
        }, 600000);
    });

    //starting typing
    var typing = false 
    let typingTimer=null ;                //timer identifier
    var keystrokes=[]
    const textarea = document.getElementById("textarea")
    const message = document.getElementById("message")
    var typingTime; 
    var donetypingdate
    var success=false

    //key up logging
    textarea.addEventListener('keyup', function(event) {

        if (success){
            //if keystrokes already sent to server for testing, do nothing
        }else{

        clearTimeout(typingTimer);

        // Make a new timeout set to go off in 1000ms (1 second)
        typingTimer = setTimeout(function () {
        
           typingTime = (new Date() - typingdate) / 1000
           
           if (typingTime<10){
                typing = false
                message.innerHTML="Please type for 20 consecutive seconds"
                textarea.value=""
                console.log(typingTime)
                keystrokes=[]
            }else{
                message.innerHTML= "Success! Analyzing Keystrokes..."
                console.log(typingTime)
                console.log(keystrokes)
                success=true;
                //Send keystrokes to server for processissing 
             }

        }, 1000);


        var timestamp = Date.now();
        if ('Escape12345`~!@#$%qwertQWERTasdfgASDFGzxcvbZXCVBCapsLock'.includes(event.key)) {
            keystrokes.push({"timestamp":timestamp, "action": "keyup", "key": event.key, "location": "left"})
        }else if ('ShiftControlAltMeta'.includes(event.key) && event.location == 1){
            keystrokes.push({"timestamp":timestamp, "action": "keyup", "key": event.key, "location": "left"})
        }else if ('ShiftControlAltMeta'.includes(event.key) && event.location == 2){
            keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": event.key, "location": "right"})
        }else if (' '.includes(event.key)){
            keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": "Space", "location": "center"})
        }else{
            keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": event.key, "location": "right"})
        }

    }
      

    });

    textarea.addEventListener('keypress', function(event) {

        if (success){
        //if keystrokes already sent to server for testing, do nothing
         }else{
            if(typing==false){
                typing=true
                message.innerHTML="Typing..."
                typingdate= new Date()
            }

            var timestamp = Date.now();
            if ('Escape12345`~!@#$%qwertQWERTasdfgASDFGzxcvbZXCVBCapsLock'.includes(event.key)) {
                var keypresstext = timestamp+ ", keypress, "+ event.key+ " left";
                keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": event.key, "location": "left"})
            } else if ('ShiftControlAltMeta'.includes(event.key) && event.location == 1){
                keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": event.key, "location": "left"})
            } else if ('ShiftControlAltMeta'.includes(event.key) && event.location == 2){
                keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": event.key, "location": "right"})
            } else if (' '.includes(event.key)){
                keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": "Space", "location": "center"})
            } else {
                keystrokes.push({"timestamp":timestamp, "action": "keypress", "key": event.key, "location": "right"})
            }
        }

  });







</script>


</body>

</html>